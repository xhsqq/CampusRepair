# 校园报修 Web 系统 (Campus Repair System)

这是一个基于 Python Flask 框架开发的轻量级校园报修管理系统，旨在为学生提供便捷的报修渠道，为维修人员提供高效的工单处理平台。本项目结构清晰，逻辑严密，非常适合作为软件工程课程的教学演示或实践项目。

## 🚀 核心功能

### 1. 角色管理 (RBAC)
- **学生 (Student)**：提交报修申请、查看个人报修历史、撤回未处理的工单。
- **维修工 (Worker)**：查看全校报修工单、接单、更新维修进度、完成工单。

### 2. 工单全生命周期管理
- **流转状态**：待接单 (NEW) -> 已接单 (ASSIGNED) -> 处理中 (IN_PROGRESS) -> 已完成 (DONE) / 已取消 (CANCELED)。
- **操作日志**：每一笔状态变更都会记录操作人、操作内容及时间戳，实现全流程溯源。

### 3. 动态特性
- **紧急程度**：支持“高/中/低”三级紧急程度，列表默认按紧急度排序。
- **权限安全**：后端接口严格校验角色权限，防止学生通过接口越权接单。

---

## 🛠️ 技术栈

- **后端**：Python 3.9+ / Flask 3.0
- **数据库**：SQLite 3 (轻量级、零配置)
- **前端**：HTML5 / Bootstrap 5 (响应式布局) / Jinja2 模板引擎
- **测试**：Requests 库自动化集成测试

---

## 📂 项目目录结构

```text
CampusRepair/
├── app.py              # Flask 核心后端逻辑 (路由、业务逻辑)
├── schema.sql          # 数据库建表语句 (含 users, repairs, repair_logs)
├── init_db.py          # 数据库初始化脚本 (自动创建表及测试账号)
├── test_system.py      # 自动化集成测试脚本 (覆盖 12 条核心用例)
├── requirements.txt    # 项目依赖包列表
├── static/             # 静态资源
│   ├── css/style.css   # 自定义样式
│   └── uploads/        # 用户上传的报修图片存放地
└── templates/          # Jinja2 前端模板
    ├── base.html       # 基础母版
    ├── auth_login.html # 登录页
    ├── dashboard.html  # 个人工作台
    ├── repairs_new.html# 新建报修页
    └── ...             # 其他功能页
```

---

## 🏁 快速开始

### 1. 环境准备
确保已安装 Python，并安装依赖：
```bash
pip install -r requirements.txt
```

### 2. 初始化数据库
运行脚本创建数据库文件并生成测试账号：
```bash
python3 init_db.py
```
**内置测试账号：**
- **学生**：`student01` / `123456`
- **维修工**：`worker01` / `123456`

### 3. 启动项目
```bash
python3 app.py
```
访问地址：`http://127.0.0.1:5001`

---

## 🧪 自动化测试

项目配套了完整的测试套件 `test_system.py`，采用**等价类划分**和**边界值分析**方法设计了 12 条测试用例，覆盖了从登录认证到越权拦截的所有核心场景。

**运行测试：**
```bash
python3 test_system.py
```

---

## 📝 数据库设计简述

系统包含三张核心表：
1. `users`：存储用户信息及角色权限。
2. `repairs`：存储工单详情，包括地点、紧急度、当前状态、图片路径等。
3. `repair_logs`：存储工单的操作流水，记录状态变更的每一个瞬间。

---

## 🏗️ 技术设计说明 (Design Specification)

### 1. 软件架构
系统采用 **B/S 架构**，基于 **Flask (MVC 模式的微框架实现)** 开发。
- **表现层 (View)**: 使用 Jinja2 模板引擎配合 Bootstrap 5 构建响应式前端。
- **控制层 (Controller)**: `app.py` 负责路由分发、Session 管理及业务逻辑控制。
- **数据层 (Model)**: 通过 `sqlite3` 驱动直接操作关系型数据库，确保数据持久化。

### 2. 核心模块划分
- **认证模块 (Auth)**: 实现用户注册、加密登录及基于 Session 的身份保持。
- **报修流转模块 (Repairs)**: 处理工单的创建、接单、状态更新及逻辑撤回。
- **审计追踪模块 (Audit)**: 通过 `repair_logs` 自动记录每一笔操作，满足软件工程的可追溯性要求。

### 3. 安全性设计
- **角色访问控制 (RBAC)**: 在后端接口层对操作者角色进行硬校验。
- **输入过滤**: 利用 Flask 和 SQLite 的参数化查询防止 SQL 注入。
- **防御性逻辑**: 拦截非法的状态机跳转（如已完成的工单不可撤回）。

---

## 💡 开发者说明

本项目在开发过程中特别注意了**防御性编程**：
- 在 `app.py` 的 `/repairs/<id>/action` 路由中，不仅校验了登录状态，还严格比对了用户角色与工单当前状态，确保业务流程符合逻辑且安全。
- 模拟了真实开发中的“需求变更”场景（增加了“紧急程度”字段），展示了良好的代码可维护性。
